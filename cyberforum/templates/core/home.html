{% extends 'base.html' %}
{% load static %}
{% block content %}
<h1 class="mb-4">Добро пожаловать на портал финансовой грамотности Удмуртии!</h1>
<div class="d-flex justify-content-center mb-4">
    <img src="{% static 'image/logo.png' %}" alt="Центр финансового просвещения" style="max-width: 300px; height: auto;">
</div>
<div class="row mb-5">
  <div class="col-lg-8 mb-4 mb-lg-0">
    <div class="bg-img position-relative">
      <img src="{% static 'image/image1.png' %}"
           class="img-fluid rounded"
           alt="Офис"
           style="max-height: 600px; object-fit: cover;">
      <div class="position-absolute top-50 start-50 translate-middle">
          <p class="h3 text-white">Здесь вы найдете полезные материалы, курсы и контакты по финансовой грамотности.</p>
          <a href="{% url 'courses:list' %}" class="btn btn-primary">Начать обучение</a>
      </div>
  </div>
  </div>
  <div class="col-lg-4">
    <div class="card h-100">
      <div class="card-header">
        <h5 class="mb-0">Ближайшие события</h5>
      </div>
      <div class="card-body">
        {% for event in events %}
          <p class="card-text"><strong>{{ event.title }}</strong><br>{{ event.date|date:"d.m.Y" }} в {{ event.location }}</p>
        {% empty %}
          <p class="text-muted">События пока не запланированы.</p>
        {% endfor %}
      </div>
    </div>
  </div>
</div>

<!-- Общие сведения -->
<div class="card mb-5">
  <div class="card-body">
    <h4 class="card-title">Общие сведения</h4>
    <p>
      Наша стратегическая задача — создание постоянно развивающейся системы и инфраструктуры для непрерывного образования и просвещения в вопросах финансовой грамотности, системы, которая бы оперативно реагировала на новые вызовы, «ловила» запросы людей и помогала бы им быстро находить ответы на вопросы, которые возникают при принятии финансовых решений.
    </p>
    <p>
      С 2008 года наша команда делится знаниями и опытом по повышению финансовой грамотности с населением Удмуртии!
    </p>
    <p><strong>Мы расскажем:</strong></p>
    <ul>
      <li>Как сохранять, накапливать и приумножать свои деньги, используя различные инвестиционные инструменты.</li>
      <li>О возможностях финансового рынка, механизмах, позволяющих улучшить своё материальное положение.</li>
      <li>Как не попадаться на уловки финансовых мошенников.</li>
    </ul>
  </div>
</div>

<!-- О коллективе -->
<div class="card mb-5">
  <div class="card-body">
    <h4 class="card-title">О коллективе</h4>
    <p>
      Наша команда — это профессионалы в области финансов, образования и цифровых технологий.
      В неё входят сертифицированные финансовые консультанты, преподаватели, методисты,
      разработчики и аналитики, объединённые общей миссией — сделать финансовую грамотность
      доступной каждому жителю Удмуртии.
    </p>
    <p>
      Мы сотрудничаем с Министерством образования и науки Удмуртской Республики,
      финансовыми организациями, школами, колледжами и центрами социальной поддержки,
      чтобы наши материалы были актуальными, проверенными и ориентированными на реальные
      потребности людей.
    </p>
    <p>
      За годы работы мы провели сотни мероприятий, обучили тысячи человек и помогли
      многим семьям принять взвешенные финансовые решения.
    </p>
  </div>
</div>

<!-- Контакты -->
<!-- Контакты -->
<div class="mb-5">
  <h4 class="mb-4">Контакты</h4>
  <div class="row g-4">
    {% for contact in contacts %}
      <div class="col-md-6 col-lg-4">
        <div class="card h-100 shadow-sm">
          <div class="card-body">
            <h5 class="card-title">{{ contact.name }}</h5>
            <p><strong>Адрес:</strong> {{ contact.address }}</p>
            <p><strong>Телефон:</strong> {{ contact.phone }}</p>
            {% if contact.email %}
              <p><strong>Email:</strong> {{ contact.email }}</p>
            {% endif %}
            <p class="text-muted small mb-0">Аудитория: {{ contact.audience }}</p>
          </div>
        </div>
      </div>
    {% empty %}
      <div class="col-12">
        <p class="text-muted">Контактная информация временно недоступна.</p>
      </div>
    {% endfor %}
  </div>
</div>

<div class="row mb-5">

<h3 class="mb-3">Популярные курсы</h3>
<div class="row g-4">
  {% for course in courses %}
    <div class="col-md-6 col-lg-4">
      <div class="card h-100">
        <div class="card-body d-flex flex-column">
          <h5 class="card-title">{{ course.title }}</h5>
          <p class="card-text flex-grow-1">{{ course.description|truncatewords:15 }}</p>
          <a href="{% url 'courses:detail' course.id %}" class="btn btn-outline-primary mt-auto">Подробнее</a>
        </div>
      </div>
    </div>
  {% endfor %}
</div>

{% if contacts %}
<div class="mt-5">
    <h3 class="mb-3">Наши офисы</h3>
    <div id="map-main" style="width: 100%; height: 300px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"></div>
</div>
{% endif %}

<script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU" type="text/javascript"></script>
<script type="text/javascript">
    ymaps.ready(initMainMap);
    function initMainMap() {
        const map = new ymaps.Map("map-main", {
            center: [56.8498, 53.2045],
            zoom: 10,
            controls: []
        });

        const contacts = [
            {% for contact in contacts %}
                {
                    name: "{{ contact.name|escapejs }}",
                    address: "{{ contact.address|escapejs }}",
                    coords: [{{ contact.latitude }}, {{ contact.longitude }}]
                },
            {% endfor %}
        ];

        contacts.forEach(contact => {
            const placemark = new ymaps.Placemark(
                contact.coords,
                {
                    balloonContentHeader: contact.name,
                    balloonContentBody: contact.address,
                    hintContent: contact.name
                },
                {
                    preset: 'islands#icon',
                    iconColor: '#6a7d5d'
                }
            );
            map.geoObjects.add(placemark);
        });

        if (contacts.length > 0) {
            const bounds = ymaps.util.bounds.fromPoints(contacts.map(c => c.coords));
            map.setBounds(bounds, { checkZoomRange: true });
        }
    }
</script>
{% endblock %}